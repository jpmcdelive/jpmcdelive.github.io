<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Weather Widget</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f0f0; 
            display: grid;
            place-items: center;
            min-height: 100vh;
        }

        .weather-widget {
            /* --- DEFAULT BACKGROUND SET HERE --- */
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1534088563585-c3E806f153d8?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwzODU4MjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NzM0MjYxNTE&ixlib=rb-4.0.3&q=80&w=400') no-repeat center center / cover; 
            /* I've used a static default Unsplash image URL just in case */
            color: white;
            padding: 20px;
            border-radius: 12px;
            width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: background-image 0.5s ease-in-out;
        }

        .current-weather {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .current-temp {
            font-size: 3.5rem;
            font-weight: 600;
            line-height: 1;
        }

        .current-conditions {
            text-align: right;
        }

        .current-icon {
            width: 60px;
            height: 60px;
        }

        .current-description {
            font-size: 0.9rem;
            margin-top: -5px;
            text-transform: capitalize;
        }

        .forecast {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
        }

        .forecast-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .forecast-time {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .forecast-icon {
            width: 40px;
            height: 40px;
        }

        .forecast-temp {
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="weather-widget">
        
        <div class="current-weather">
            <div class="current-temp" id="current-temp">--°</div>
            <div class="current-conditions">
                <img src="" alt="Weather icon" class="current-icon" id="current-icon">
                <div class="current-description" id="current-description">Loading...</div>
            </div>
        </div>
        
        <div class="forecast">
            <div class="forecast-item">
                <div class="forecast-time" id="forecast-time-1">--:-- --</div>
                <img src="" alt="Icon" class="forecast-icon" id="forecast-icon-1">
                <div class="forecast-temp" id="forecast-temp-1">--°</div>
            </div>
            <div class="forecast-item">
                <div class="forecast-time" id="forecast-time-2">--:-- --</div>
                <img src="" alt="Icon" class="forecast-icon" id="forecast-icon-2">
                <div class="forecast-temp" id="forecast-temp-2">--°</div>
            </div>
        </div>

    </div>

    <script>
        // ------------------------------------------------------------------
        // --- CONFIGURATION: YOU NOW NEED TWO API KEYS ---
        // ------------------------------------------------------------------

        // 1. Get your free weather API key from https://openweathermap.org/appid
        const weatherApiKey = 'cc89b86463a5016e19b544c61d9a9117'; 

        // 2. *** NEW *** Get your Unsplash Access Key from https://unsplash.com/developers
        const unsplashApiKey = 'VQZFbs5zX4fJECBRq2VN0R9TgBMPOrM7r6d2ZH0qmEs';

        // 3. Set your city
        const city = 'New York'; 

        // ------------------------------------------------------------------

        // Base URL for animated icons
        const iconBaseUrl = 'https://bmcdn.nl/assets/weather-icons/v3.0/fill/svg/';
        const defaultIcon = 'cloudy.svg';

        // Mapping for search terms
        const weatherBackgrounds = {
            'clear': 'clear sky', 'clouds': 'cloudy sky', 'rain': 'rainy weather',
            'drizzle': 'drizzle rain', 'thunderstorm': 'thunderstorm lightning',
            'snow': 'snowy landscape', 'mist': 'mist fog', 'fog': 'foggy forest',
            'default': 'weather background'
        };

        function mapOwmIconToSvg(iconCode) {
            const iconMap = {
                '01d': 'clear-day', '01n': 'clear-night',
                '02d': 'partly-cloudy-day', '02n': 'partly-cloudy-night',
                '03d': 'cloudy', '03n': 'cloudy',
                '04d': 'overcast-day', '04n': 'overcast-night',
                '09d': 'drizzle', '09n': 'drizzle',
                '10d': 'partly-cloudy-day-rain', '10n': 'partly-cloudy-night-rain',
                '11d': 'thunderstorms-day-rain', '11n': 'thunderstorms-night-rain',
                '13d': 'partly-cloudy-day-snow', '13n': 'partly-cloudy-night-snow',
                '50d': 'fog-day', '50n': 'fog-night',
            };
            return iconMap[iconCode] || 'cloudy';
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp * 1000);
            let hours = date.getHours();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; 
            return `${hours} ${ampm}`;
        }

        /**
         * --- NEW: Function to update background using the Unsplash API ---
         */
        async function updateBackgroundFromApi(weatherMain) {
            if (unsplashApiKey === 'YOUR_UNSPLASH_ACCESS_KEY_HERE') {
                console.warn('Unsplash API key not set. Using default background.');
                return; // Exit if the Unsplash key is not set
            }

            const searchTerm = weatherBackgrounds[weatherMain.toLowerCase()] || weatherBackgrounds['default'];
            const unsplashApiUrl = `https://api.unsplash.com/photos/random?query=${searchTerm}&client_id=${unsplashApiKey}&orientation=portrait`;
            
            const widget = document.querySelector('.weather-widget');

            try {
                const response = await fetch(unsplashApiUrl);
                if (!response.ok) {
                    throw new Error(`Unsplash API error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Get the image URL. 'regular' is a good size.
                const imageUrl = data.urls.regular; 
                
                // Set the new background
                widget.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('${imageUrl}')`;

            } catch (error) {
                console.error('Error fetching Unsplash background:', error);
                // On error, the default background from the CSS will remain.
            }
        }
        
        function setErrorState() {
            console.error('Error fetching weather data. Setting default state.');
            
            document.getElementById('current-description').textContent = 'Failed to load';
            document.getElementById('current-temp').textContent = '--°';
            document.getElementById('current-icon').src = iconBaseUrl + defaultIcon;
            document.getElementById('forecast-icon-1').src = iconBaseUrl + defaultIcon;
            document.getElementById('forecast-icon-2').src = iconBaseUrl + defaultIcon;
        }

        async function fetchWeather() {
            if (weatherApiKey === 'YOUR_OPENWEATHERMAP_API_KEY_HERE') {
                setErrorState();
                console.error('Weather API key is placeholder. Please replace it.');
                document.getElementById('current-description').textContent = 'Set API Key';
                return;
            }

            const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${weatherApiKey}&units=imperial`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                // --- 1. Update Current Weather ---
                const current = data.list[0];
                const currentIconCode = current.weather[0].icon;
                const weatherMain = current.weather[0].main;
                
                document.getElementById('current-temp').textContent = `${Math.round(current.main.temp)}°`;
                document.getElementById('current-description').textContent = current.weather[0].description;
                document.getElementById('current-icon').src = `${iconBaseUrl}${mapOwmIconToSvg(currentIconCode)}.svg`;
                
                // --- THIS IS THE UPDATED CALL ---
                // Now we call the Unsplash API function
                updateBackgroundFromApi(weatherMain);

                // --- 2. Update Hourly Forecast ---
                const forecast1 = data.list[1]; 
                const forecast2 = data.list[2]; 

                if (forecast1) {
                    const forecast1IconCode = forecast1.weather[0].icon;
                    document.getElementById('forecast-time-1').textContent = formatTime(forecast1.dt);
                    document.getElementById('forecast-temp-1').textContent = `${Math.round(forecast1.main.temp)}°`;
                    document.getElementById('forecast-icon-1').src = `${iconBaseUrl}${mapOwmIconToSvg(forecast1IconCode)}.svg`;
                }

                if (forecast2) {
                    const forecast2IconCode = forecast2.weather[0].icon;
                    document.getElementById('forecast-time-2').textContent = formatTime(forecast2.dt);
                    document.getElementById('forecast-temp-2').textContent = `${Math.round(forecast2.main.temp)}°`;
                    document.getElementById('forecast-icon-2').src = `${iconBaseUrl}${mapOwmIconToSvg(forecast2IconCode)}.svg`;
                }

            } catch (error) {
                setErrorState();
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            fetchWeather();
            
            document.querySelectorAll('img').forEach(img => {
                img.addEventListener('error', () => {
                    img.src = iconBaseUrl + defaultIcon;
                });
            });
        });
    </script>

</body>
</html>
