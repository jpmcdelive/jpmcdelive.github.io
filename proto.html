<!DOCTYPE html>
<html lang="en">
	<head> 
		<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>P2Gm Digital Signage @ The Manhattan Hub</title>
		<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Fira+Sans+Condensed:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">

		<style>
			body {
				font-family:"Fira Sans Condensed",sans-serif;
				font-weight:400;
				font-style:normal;
				color:#fff;
				margin:0;
			}
			.weather-widget {
				height: 82px; 
			}
			.current-weather {
				display:flex;
			}
			.current-temp {
				font-size:3.5rem;
				font-weight:600;
				line-height:1;
				padding:10px 0 0 30px
			}
			.current-condition {
				text-align:center;
				padding:0 41px 0 0
			}
			.current-icon {
				width:80px;height:80px
			}
			.current-description {
				font-weight: 200;
    		margin: 15px 8px 0px 5px;
   		 	line-height: .9;
			}
			#news-widget {
				overflow:hidden;
			}
			
			#next-day-off { padding: 15px; }
			#next-day-off h3 { margin:0; font-size: 1.1em; }
			#next-day-off p { margin:0; font-weight: 300; }

			h1 { font-size: 1.8vw; margin:0; padding: 0 15px; text-align: left; font-weight: 400;}
			
			#carousel-content {
				padding:0!important
			}
			.article-card {
				display:flex;
				height: fit-content;

			}
			.article-image {
				object-fit:cover;
				flex-shrink:0
			}
			.article-content {
				flex-grow:1;
				min-width:0;
				margin:0; 
			}
			.article-content img { height: fit-content; }

			#carousel-nav {
				display:flex;
				justify-content:space-between;
				align-items:center;
				padding:10px 20px;
				background-color:#000;
			}
			#day {
				font-size:2vw;
				font-weight:100;
				line-height:.85;
			}
			#date {
				font-size:2vw;
				font-weight:400;
				line-height:1;
			}
			#time {
				font-size: 3.5vw;
				line-height:1;
				font-weight:700
			}
			.loading,.error {
				text-align:center;
				padding:40px;
				font-size:16px;
				color:#777
			}
			#temp { font-size: 3.75vw; margin-left:-5px; }
			@keyframes fadeIn {
				from{opacity:0;transform:translateY(0)}to{opacity:1;transform:translateY(0)}
			}		
			.article-content h3 { 
				margin-top:-70px;
				background: black;
				padding: 0 10px;
				color:white;
				font-weight:600;
				line-height: 1;
				display: -webkit-box; 
				-webkit-line-clamp: 3; 
				-webkit-box-orient: vertical; 
				overflow: hidden; 
				font-size: 1.4vw;
				min-height: 65px; 
				max-height: 82px; 
				text-shadow: -1px 1px 1px #333, 1px -1px 1px #333, 1px 1px 1px #333, -1px -1px 1px #333;
			}

			#schedule-widget { 
				font-weight:400;
				display: flex; 
				justify-content: center; 
				align-items: center; 
				background-color: peachpuff; 
				text-align: center; 
			}

			#schedule-period { 
				font-size: 1.7rem; 
				text-transform: uppercase; 
				color: #555; 
			}

			#icon-container { height: 62px; }

			#icon-container img {
				width: 55px;
    		height: 55px;
    		padding: 0 20px 0 15px;
			}



			div img {
				width: 100%;
			}

			.grid-container {
			  display: grid;
			  grid-template-columns: .9fr 1.25fr 1fr 1fr .85fr; 
			  grid-template-rows: 2.9fr .2fr .2fr 1fr .7fr;
			  gap: 2px;
			  width: 100vw;
			  height: 100vh;
			  background: #000;
			}

			.time-date { padding: 15px 20px; justify-content: flex-start;}

			.grid-item {
			  border-radius: 0px;
			  display: flex;
			  align-items: unset;
			  justify-content: left;
			  color: white;
			  font-weight: 600;    
			  margin-block-start: 0;
    		margin-block-end: 0;
			  
			}

			.grid-item img {
			  width: 100%;
			  height: 100%;
			  object-fit: cover; 
			  display: block;
			}

			h1 { 
				line-height: 1.1; }
			h2 { color: darkslategray; }

			.item-1 {
			  grid-column: 1 / 5;
			  grid-row: 1 / 5;
			  background-color: #000;
			}

			.item-2 {
			  grid-column: 5 / 6;
			  grid-row: 1 / 2;
			  background-color: antiquewhite;
			}

			.item-3 {
			  grid-column: 5 / 6;
			  grid-row: 2 / 3;
			  background-color: rgba(119, 119, 119, 1);
			  align-items: center; 
			}

			.item-4 {
			  grid-column: 5 / 6;
			  grid-row: 3 / 4;
			  background: #5e5e5e;
				background: rgba(94, 94, 94, 1);
			  padding-top: 8px;
			}

			.item-5 {
			  grid-column: 5 / 6;
			  grid-row: 4 / 5;
			  background-color: #000;
			}

			.item-6 {
			  grid-column: 1 / 2;
			  grid-row: 5 / 6;
			  background-color: antiquewhite;
			  overflow: hidden;
			}
			.item-6 img { object-fit:cover; }
			.item-7 {
			  grid-column: 2 / 5;
			  grid-row: 5 / 6;
			  background-color: rgba(82, 82, 82, 1);
			}

			.item-8 {
			  grid-column: 5 / 6;
			  grid-row: 5 / 6;
			  background: rgba(60, 60, 60, 1);
			}

			/* Mobile breakpoint (≤ 768px) - 1 column */
			@media (max-width: 768px) {
			  .grid-container {
			    grid-template-columns: 1fr !important;
			    grid-auto-rows: auto;
			  }

			  .item-1 {
			    grid-column: 1 / -1 !important;
			    grid-row: 1;
			    order: 1;
			  }
			}
		</style>

	</head>	
	<body> 
		<div class="grid-container">
			<div class="grid-item item-1">
  			<img src="content/1.png"/>
			</div>
  		<div class="grid-item item-2">
   			<div id="schedule-widget"><img id="schedule-period" src=""/></div>
  		</div>
  		<div class="grid-item item-3">
   			<div id="next-day-off"> <h3>NEXT DAY OFF MARCH 20</h3><p>Eid Al Fitr, schools closed.</p></div>
  		</div>
  		<div class="grid-item item-4">
    		<span id="icon-container" style="height: 61px;"></span>
    		<span id="temp">--°</span>
    		<span id="desc" class="current-description" display: none; >Loading...</span>
	  	</div>
	  	<div class="grid-item item-5">
	   		<div id="news-widget"><div id="carousel-content"><div id="loading-message" class="loading">Loading news...</div></div></div> 	 	
	  	</div>
	  	<div class="grid-item item-6">
	  			<!-- <h2 style="padding: 13px 0 0 13px; margin-block-start: 0; margin-block-end: 0; font-size:3vw; font-weight: 700; line-height: .93; ">Pathways to Graduation<div style="font-weight: 400; font-size: 1.5vw; color: black; margin-left: 9vw;">manhattan</div></h2> -->
	  			<img src="content/school.png" alt="Pathways to Graduation Manhattan"/>
	  	</div>
	  	<div class="grid-item item-7" style="align-items: center;">
	    		<div align="center"><h1>Education should train the child to use his brains, to make for himself a place in the world and maintain his rights even when it seems that society would shove him into the scrap-heap. -—Helen Keller</h1></div>
	  	</div>
	  	<div class="grid-item item-8">
	    	<div class="time-date weather-widget"> 
	    		<div id="day" class="caption dayText"></div>
	    		<div id="date" class="caption dateText"></div> 
	    		<div id="time" class="caption timeText"></div> 
	    	</div>
	  	</div>
		</div>
	</body>

	<script>

	// main
	
		// MAIN (1)
				const imageElement = document.querySelector('.item-1 img'); const images = ['1.png', '2.png', '3.png', '4.png', '5.png']; let currentIndexa = 0;
				setInterval(() => { currentIndexa = (currentIndexa + 1) % images.length; imageElement.src = 'content/'+images[currentIndexa];}, 
					10000 );

	// side

		// SCHEDULE (2)
				function updateSchedule(){
					const now=new Date();const currentMinutes=(now.getHours()*60)+now.getMinutes();
					let statusText="Free Time";const schedule=[
			      {name:"bk.png",start:480,end:530}, //  08:00-08:50 bk
			      {name:"p1.png",start:530,end:580}, //  08:50-09:40 p1
			      {name:"p2.png",start:580,end:632}, //  09:40-10:32 p2
			      {name:"p3.png",start:632,end:686}, //  10:32-11:24 p3
			      {name:"lc.png",start:686,end:738}, //  11:26-12:18 lch
			      {name:"p5.png",start:738,end:788}, //  12:18-01:08 p5
			      {name:"p6.png",start:788,end:840}, //  01:08-02:00 p6
			      {name:"p7.png",start:840,end:890}, //  02:00-02:50 prep
			      {name:"cl.png",start:890,end:960}];//  02:50-04:00 gn
				  const activePeriod=schedule.find(p=>currentMinutes>=p.start&&currentMinutes<p.end);
				  if (activePeriod){statusText=activePeriod.name;}
				  	else if(currentMinutes< 480){statusText="bk.png";}
				  	else if(currentMinutes>=960){statusText="cl.png";}
					var Image_Id=document.getElementById('schedule-period'); 
					var newURL="schedule/"+statusText;Image_Id.src=newURL;
					console.log("PERIOD: "+newURL);}
				updateSchedule();setInterval(updateSchedule,60000);

		// NEXT-DAY-OFF (3)

		// WEATHER (4)
			    const apiKey='3705bab40a0bc21845733bbd24c752ba';const lat=40.7549;const lon=-73.9840;

			    async function updateWeather() {
		        try {
		            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=imperial&appid=${apiKey}`);
		            if (!res.ok) throw new Error('API Error');
		            const data = await res.json();
		            
		            document.getElementById('temp').innerText = `${Math.round(data.main.temp)}°`;
		            document.getElementById('desc').innerText = data.weather[0].description;

		            const iconCode = data.weather[0].icon;
		            const iconContainer = document.getElementById('icon-container');
		            const iconURL = `<img src="weather/${iconCode}.png" alt="weather">`; console.log(iconURL);
		            iconContainer.innerHTML = iconURL;

		       	} catch (err) {document.getElementById('desc').innerText = "Check API Key"; console.error(err);}
		    	}
    updateWeather();

		// NEWS (5)
					const NYT_API_KEY="fA2AACnKOZWVnU8C0kcCLkivelqlxDQc";const NYT_SECTION="home";
					const ARTICLE_COUNT=3;let articlesData=[];let currentIndex=0;
					const carouselContent=document.getElementById('carousel-content');
					const loadingMessage=document.getElementById('loading-message');
					const navContainer=document.getElementById('carousel-nav');
					const prevBtn=document.getElementById('prev-btn');
					const nextBtn=document.getElementById('next-btn');
					const slideIndicator=document.getElementById('slide-indicator');
					const apiUrl=`https://api.nytimes.com/svc/topstories/v2/${NYT_SECTION}.json?api-key=${NYT_API_KEY}`;
					
					function renderArticle(index){
						if(articlesData.length===0)return;
						const article=articlesData[index];
						let imageUrl="";let imageAlt="Article image";
						if(article.multimedia&&article.multimedia.length>0){
							const image=article.multimedia[2]||article.multimedia[0];imageUrl=image.url;imageAlt=image.caption||article.title}
						carouselContent.innerHTML=`<div class="article-card"><div class="article-content">${imageUrl?`<img src="${imageUrl}" alt="${imageAlt}" class="article-image">`:''}<h3>${article.title}</h3></div></div>`;}
						
						async function fetchNews(){
							try{
								const response=await fetch(apiUrl);
								if(!response.ok){if(response.status===401||response.status===403){throw new Error("API Key error. Make sure your key is correct.")}throw new Error(`Network error: ${response.statusText}`)}
								
								const data=await response.json();articlesData=data.results.filter(a=>a.title&&a.url&&a.abstract).slice(0,ARTICLE_COUNT);
								if(articlesData.length===0){throw new Error("No valid articles found.")}loadingMessage.style.display='none';currentIndex=0;renderArticle(currentIndex)}
							
							catch(error){console.error("Failed to fetch news:",error);loadingMessage.textContent=`Failed to load news. ${error.message}`;loadingMessage.className='error'}}
							
						nextArticle=function(){currentIndex=(currentIndex+1)%articlesData.length;
						renderArticle(currentIndex)};
						setInterval(nextArticle,10000);
						document.addEventListener('DOMContentLoaded',fetchNews)

	// bottom 

	 	// SEASON LOGO (6)

		// QUOTE (7)

		// DAY DATE TIME (8)
						var setCaptions=function(){const now=new Date();
						const timeOptions={hour:'numeric',minute:'2-digit',hour12:true};
						const formattedTime=new Intl.DateTimeFormat('en-US',timeOptions).format(now);
						document.getElementById('time').textContent=formattedTime};const now=new Date();const dayOptions={weekday:'long'};
						document.getElementById('day').textContent=new Intl.DateTimeFormat('en-US',dayOptions).format(now);
						function getOrdinalDate(date){const day=date.getDate();const s=['th','st','nd','rd'];
						const v=day%100;return day+(s[(v-20)%10]||s[v]||s[0])}
						const monthYearOptions={year:'numeric',month:'long'};
						const monthYear=new Intl.DateTimeFormat('en-US',monthYearOptions).format(now);
						const fullDateText=monthYear.replace(/\d+/,getOrdinalDate(now));document.getElementById('date').textContent=fullDateText;setCaptions();setInterval(function(){setCaptions()},10*1000);

	</script>

</html>