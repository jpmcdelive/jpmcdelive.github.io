<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Widget</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <style>
        weather { background-color: #f0f0f0; display: grid; place-items: center; min-height: 100vh; }
            .weather-widget { background: #6c757d; color: white; padding: 20px; border-radius: 12px; width: 250px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }

            .current-weather { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
            .current-temp { font-size: 3.5rem; font-weight: 600; line-height: 1; }
            .current-conditions { text-align: right; }
            .current-icon { width: 60px; height: 60px; }
            .current-description { font-size: 0.9rem; margin-top: -5px; text-transform: capitalize; }
        
            .forecast { display: flex; justify-content: space-between; padding: 0 10px; }
            .forecast-item { display: flex; flex-direction: column; align-items: center; font-size: 0.9rem; }
            .forecast-time { font-weight: 500; margin-bottom: 5px; }
            .forecast-icon { width: 40px; height: 40px; }
            .forecast-temp { font-size: 1.1rem; font-weight: 500; margin-top: 5px; }

        news { font-family: "Segoe UI", sans-serif; background-color: #f4f4f4; display: flex; justify-content: center; align-items: left; padding: 20px; }
            #news-widget { width: 100%; max-width: 600px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); overflow: hidden; }

            header { padding: 16px 20px; border-bottom: 1px solid #eee; background-color: #fafafa; }
            header h2 { margin: 0; font-size: 20px; }

            #carousel-content { padding: 20px; min-height: 250px; }
        
            .article-card { display: flex; gap: 15px; animation: fadeIn 0.4s ease-out; }
            .article-image { width: 120px; height: 120px; object-fit: cover; border-radius: 6px; flex-shrink: 0; }
            .article-content { flex-grow: 1; min-width: 0; }
            .article-content h3 { margin: 0 0 5px 0; font-size: 18px; }
            .article-content a { text-decoration: none; color: #121212; }
            .article-content p { margin: 0 0 15px 0; font-size: 14px; color: #555; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden; }

            .article-qrcode { width: 90px; height: 90px; flex-shrink: 0; }
            .article-qrcode canvas,
            .article-qrcode img { padding: 4px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

            #carousel-nav { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; border-top: 1px solid #eee; background-color: #fafafa; }
            #carousel-nav button { background-color: #007aff; color: white; border: none; padding: 8px 14px; border-radius: 5px; font-size: 14px; font-weight: 500; cursor: pointer; }
            #carousel-nav button:hover { background-color: #0056b3; }
            #carousel-nav button:disabled { background-color: #ccc; cursor: not-allowed; }
            #slide-indicator { font-size: 14px; color: #555; font-weight: 500; }
            .loading, .error { text-align: center; padding: 40px; font-size: 16px; color: #777; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    
    <weather>
        <div class="weather-widget">
            <div class="current-weather">
                <div class="current-temp" id="current-temp">--°</div>
                <div class="current-conditions">
                    <img src="" alt="Weather icon" class="current-icon" id="current-icon">
                    <div class="current-description" id="current-description">Loading...</div>
                </div>
            </div>
        <div class="forecast">
            <div class="forecast-item">
                <div class="forecast-time">01:00 PM</div>
                <img src="" alt="Icon" class="forecast-icon" id="forecast-icon-1">
                <div class="forecast-temp" id="forecast-temp-1">--°</div>
            </div>
            <div class="forecast-item">
                <div class="forecast-time">04:00 PM</div>
                <img src="" alt="Icon" class="forecast-icon" id="forecast-icon-2">
                <div class="forecast-temp" id="forecast-temp-2">--°</div>
            </div>
        </div>
    </weather>
    
    <news>
            <div id="news-widget">
                <header><h2>New York Times Headlines</h2></header>
                <div id="carousel-content"><div id="loading-message" class="loading">Loading news... </div></div>
            </div>
    </news>
    
    <script>
        const NYT_API_KEY = "fA2AACnKOZWVnU8C0kcCLkivelqlxDQc";
        const NYT_SECTION = "home"; 
        const ARTICLE_COUNT = 7;

        let articlesData = [];
        let currentIndex = 0;

        const carouselContent = document.getElementById('carousel-content');
        const loadingMessage = document.getElementById('loading-message');
        const navContainer = document.getElementById('carousel-nav');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const slideIndicator = document.getElementById('slide-indicator');

        const apiUrl = `https://api.nytimes.com/svc/topstories/v2/${NYT_SECTION}.json?api-key=${NYT_API_KEY}`;

        function renderArticle(index) {
            if (articlesData.length === 0) return;
            const article = articlesData[index];      
            let imageUrl = ""; let imageAlt = "Article image";
            if (article.multimedia && article.multimedia.length > 0) { const image = article.multimedia[2] || article.multimedia[0]; imageUrl = image.url; imageAlt = image.caption || article.title; }
            const qrCodeId = 'article-qr-code-placeholder';
            carouselContent.innerHTML = `
                <div class="article-card">
                    <div class="article-content">
                        <h3><a href="${article.url}" target="_blank" rel="noopener noreferrer">${article.title}</a></h3>
                        <p>${article.abstract}</p>
                        ${imageUrl ? `<img src="${imageUrl}" alt="${imageAlt}" class="article-image">` : ''}
                    </div>
                    <div class="article-qrcode" id="${qrCodeId}"></div>
                </div>`;
            new QRCode(document.getElementById(qrCodeId), { text: article.url, width: 90, height: 90, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.M });
            slideIndicator.textContent = `${index + 1} / ${articlesData.length}`;
        }

        async function fetchNews() {
            try { const response = await fetch(apiUrl);
                if (!response.ok) { if (response.status === 401 || response.status === 403) { throw new Error("API Key error. Make sure your key is correct."); } throw new Error(`Network error: ${response.statusText}`); }
                const data = await response.json(); articlesData = data.results .filter(a => a.title && a.url && a.abstract) .slice(0, ARTICLE_COUNT);
                if (articlesData.length === 0) { throw new Error("No valid articles found."); }
                 loadingMessage.style.display = 'none'; navContainer.style.display = 'flex'; currentIndex = 0; renderArticle(currentIndex);
            } catch (error) { console.error("Failed to fetch news:", error); loadingMessage.textContent = `Failed to load news. ${error.message}`; loadingMessage.className = 'error'; } }
        document.addEventListener('DOMContentLoaded', fetchNews);
    </script>
</body>
</html>
